# Схема базы данных "Подарки и доставка"

На основе предоставленных данных я спроектировал следующую схему базы данных:

## Сущности и их связи

1. **Categories** - категории подарков
2. **Cities** - города с их географическими координатами
3. **Warehouses** - склады в городах
4. **Gifts** - подарки с привязкой к категориям
5. **Stocks** - запасы подарков на складах
6. **Letters** - письма с пожеланиями подарков
7. **Deliveries** - информация о доставке
8. **Weather** - данные о погоде в городах

## Диаграмма базы данных (текстовое представление)

```
Cities (1) ──── (n) Warehouses (1) ──── (n) Stocks
  │                                       │
  │                                       │
Weather (n) ──── (1)                    Gifts (1) ──── (n) Categories
                                          │
                                          │
                                        Letters (1) ──── (1) Deliveries
```

## Подробное описание таблиц


```sql

CREATE TABLE Categories (
    category_value VARCHAR(255) PRIMARY KEY
);

CREATE TABLE Cities (
    city_id INT PRIMARY KEY,
    city_name VARCHAR(255) NOT NULL,
    latitude DECIMAL(9,6) NOT NULL,
    longitude DECIMAL(9,6) NOT NULL
);

CREATE TABLE Warehouses (
    warehouse_id INT PRIMARY KEY,
    city_id INT NOT NULL,
    warehouse_name VARCHAR(255) NOT NULL,
    FOREIGN KEY (city_id) REFERENCES Cities(city_id)
);


CREATE TABLE Gifts (
    gift_id INT PRIMARY KEY,
    gift_name VARCHAR(255) NOT NULL,
    category_value VARCHAR(255) NOT NULL,
    FOREIGN KEY (category_value) REFERENCES Categories(category_value)
);

CREATE TABLE Stocks (
    stock_id INT PRIMARY KEY,
    warehouse_id INT NOT NULL,
    gift_id INT NOT NULL,
    quantity INT NOT NULL,
    FOREIGN KEY (warehouse_id) REFERENCES Warehouses(warehouse_id),
    FOREIGN KEY (gift_id) REFERENCES Gifts(gift_id)
);

CREATE TABLE letters (
    letter_id INT AUTO_INCREMENT PRIMARY KEY,
    child_name VARCHAR(100) NOT NULL,
    child_age TINYINT UNSIGNED NOT NULL,
    city_id INT UNSIGNED NOT NULL,
    letter_date DATE NOT NULL,
    gift_id INT UNSIGNED,
    
    -- Ограничения для внешних ключей
    FOREIGN KEY (city_id) REFERENCES cities(city_id),
    FOREIGN KEY (gift_id) REFERENCES gifts(gift_id)
);


CREATE TABLE Deliveries (
    delivery_id INT PRIMARY KEY,
    letter_id INT NOT NULL,
    warehouse_id INT NOT NULL,
    delivery_status VARCHAR(50) NOT NULL,
    send_date DATE,
    delivery_date DATE,
    FOREIGN KEY (letter_id) REFERENCES Letters(letter_id),
    FOREIGN KEY (warehouse_id) REFERENCES Warehouses(warehouse_id)
);

CREATE TABLE Weather (
    weather_id INT PRIMARY KEY,
    city_id INT NOT NULL,
    date DATE NOT NULL,
    temperature DECIMAL(5,2) NOT NULL,
    FOREIGN KEY (city_id) REFERENCES Cities(city_id)
);
```

## Замечания по проектированию

1. В исходных данных в таблице Letters не указаны названия столбцов. Я предположил следующую структуру:
   - letter_id
   - recipient_name
   - city_id
   - gift_id
   - letter_date
   - age

2. Для таблицы Deliveries добавлены внешние ключи на Letters и Warehouses для обеспечения целостности данных.

3. В таблице Gifts категория "Игрушки" отсутствует в исходных данных Categories. В реальной системе нужно либо добавить эту категорию, либо изменить категории подарков.

4. Для улучшения производительности можно добавить индексы на часто используемые поля, например:
   - Индекс на city_id в таблице Warehouses
   - Индекс на gift_id в таблице Stocks
   - Индекс на delivery_status в таблице Deliveries

Эта схема обеспечивает нормализованную структуру данных с поддержкой всех представленных в исходных данных отношений.